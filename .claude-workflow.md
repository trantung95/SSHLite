<!--
Copyright 2026 SSH Lite Contributors
SPDX-License-Identifier: Apache-2.0
-->

# SSH Lite - Claude Code Workflow

**Version**: 0.2.5 | **Tests**: 792 across 30 suites

---

## Project Overview

**SSH Lite** is a lightweight VS Code extension for SSH connections that works WITHOUT installing a VS Code server on remote machines (unlike Remote-SSH).

### Core Principles
1. **Simple and easy to use** - Most important
2. **No server installation** - Pure SSH/SFTP
3. **Auto-save credentials** - No complex management
4. **Lightweight** - Minimal footprint

---

## Features Summary

| # | Feature | Key Points |
|---|---------|------------|
| 1 | **SSH Connection** | Parse ~/.ssh/config, manual hosts, password/key/agent auth, auto-save creds, host filter |
| 2 | **File Browser** | Tree view, navigate (path/parent/home/root), auto-refresh |
| 3 | **File Operations** | Open/edit/save, upload badges (↑/✗), download, delete, create folder, large file handling |
| 4 | **File Auto-Refresh** | Global timer, focused first, skip dirty/uploading files |
| 5 | **Terminal** | SSH terminal, multiple per connection, reuse connection |
| 6 | **Port Forwarding** | Forward ports, list/stop forwards |
| 7 | **Server Monitoring** | Quick status, diagnose, watch, services, logs |
| 8 | **Audit Trail** | Log operations, track diffs, export |
| 9 | **Search Panel** | Webview, multi-scope, include/exclude patterns, list/tree view, cancel |
| 10 | **Filename Filter** | Glob pattern, hide non-matching, empty folder graying, reveal auto-clear |
| 11 | **Auto-Reconnect** | VPN/network drop recovery, preserves credentials |
| 12 | **Activity Panel** | Track operations, group by server/type, cancel |
| 13 | **Orphaned Files** | Detect previous session files, reconnect button |
| 14 | **Progressive Download** | Tail preview, background load, progress |
| 15 | **File Watching** | inotifywait/fswatch, polling fallback |
| 16 | **Change Tracking** | "M" badge, diff icon, server backups |

---

## Project Structure

```
src/
├── extension.ts                    # Main entry, commands
├── types.ts                        # Interfaces
├── connection/
│   ├── ConnectionManager.ts        # Multi-connection, auto-reconnect
│   └── SSHConnection.ts            # SSH/SFTP operations
├── services/
│   ├── HostService.ts              # SSH config parsing
│   ├── FileService.ts              # File ops, auto-sync
│   ├── TerminalService.ts          # SSH terminals
│   ├── PortForwardService.ts       # Port forwarding
│   ├── CredentialService.ts        # Credentials + pinned folders
│   ├── AuditService.ts             # Audit logging
│   ├── ServerMonitorService.ts     # Server diagnostics
│   ├── ActivityService.ts          # Activity tracking
│   └── CommandGuard.ts             # Data transfer tracking
├── providers/
│   ├── HostTreeProvider.ts         # SSH hosts tree
│   ├── FileTreeProvider.ts         # Remote files tree
│   ├── FileDecorationProvider.ts   # Badges, decorations
│   ├── PortForwardTreeProvider.ts  # Port forwards tree
│   └── ActivityTreeProvider.ts     # Activity panel
└── webviews/
    └── SearchPanel.ts              # Search webview
```

---

## Key APIs

### CredentialService
```typescript
await creds.listCredentials(hostId)
await creds.addCredential(hostId, label, type, value, keyPath?)
await creds.getCredentialSecret(hostId, credentialId)
await creds.addPinnedFolder(hostId, credentialId, name, remotePath)
```

### FileService Save Flow
1. User Ctrl+S → onDidSaveTextDocument
2. Capture content, mark uploading, show ↑ badge
3. Debounced upload (60s timeout)
4. Success: clear state, show status | Failure: show ✗ badge

### CommandGuard (Activity Tracking)
```typescript
await guard.readFile(connection, remotePath)   // tracked download
await guard.writeFile(connection, remotePath, content)  // tracked upload
await guard.listFiles(connection, remotePath)  // tracked directory load
```

---

## Configuration

```json
{
  "sshLite.connectionTimeout": 30000,
  "sshLite.keepaliveInterval": 30000,
  "sshLite.uploadDebounceMs": 500,
  "sshLite.fileRefreshIntervalSeconds": 3,
  "sshLite.searchMaxResults": 2000,
  "sshLite.enableChangeTracking": true
}
```

---

## Commands

**Connection**: connect, disconnect, addHost, editHost, removeHost, refreshHosts, filterHosts, clearHostFilter
**Navigation**: goToPath, goToParent, goToHome, goToRoot
**Files**: openFile, downloadFile, uploadFile, deleteRemote, createFolder, refreshFiles, copyPath, revealInTree
**Terminal**: openTerminal, openTerminalHere, forwardPort, stopForward
**Filter/Search**: filterFiles, clearFilter, filterFileNames, clearFilenameFilter, showSearch, cancelSearch
**Activity**: cancelActivity, cancelAllActivities, toggleActivityGrouping

---

## Testing

```bash
npx jest --no-coverage      # Run all tests
npx jest -- HostTreeProvider  # Run specific file
```

### Test Files
- `ConnectionManager.test.ts` — Connect lifecycle, auto-reconnect
- `HostTreeProvider.test.ts` — Server grouping, credentials, host filter
- `FileTreeProvider.test.ts` — Filter matching, glob patterns
- `FileDecorationProvider.test.ts` — Badges, empty folder graying
- `FileService.test.ts` — Save flow, debounce, upload state
- `SearchPanel.test.ts` — Scope management, cancellation

---

## Building

```bash
npm run compile    # Compile TypeScript
npm run watch      # Watch mode
npx vsce package   # Create .vsix
```

---

## Recent Changes (v0.2.5)

- **Remove User**: Delete credential entries from both saved hosts and ~/.ssh/config
- **Delete in all states**: Trash icon and right-click menu work for connected/disconnected users
- **SSH config editing**: Uses ssh-config library to safely remove Host blocks

## Previous Changes (v0.2.2)

- **Host filter**: Filter hosts panel by name/hostname/username with glob support
- **Empty folder graying**: Folders with no matching descendants grayed out after filter
- **Reveal auto-clear**: Filter auto-clears when revealing hidden file
- **Upload state badges**: ↑ (uploading), ✗ (failed) via FileDecorationProvider
- **Search cancel**: New search auto-cancels previous running search
- **Change tracking**: "M" badge and diff icon for modified files
